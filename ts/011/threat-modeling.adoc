= Threat modeling

Threat modeling is the process of analyzing representations of a system with the purpose of identifying potential security and privacy vulnerabilities, and deciding on mitigation strategies.

Threat modeling is more of a process than a tool or an artifact. Threat modeling should be cross-functional and iterative. It should be built into the regular development process, rather than a one-time activity.

Threat modeling sessions SHOULD begin during the design phase of a new software product, or of a major new feature within an existing product. Thereafter, the threat assessments SHOULD be treated as living documents that are regularly revised as the system evolves, new threats emerge, or business requirements change.

Effective threat modeling benefits from a multi-disciplinary approach. Participants in threat modeling sessions should be drawn from architecture and security, product and business, and development, testing, and operations. The purpose is to view the system from diverse perspectives.

Various types of models SHOULD be used as input to threat modeling sessions. Different representations of a system will reveal different categories of potential attack vectors. RECOMMENDED models include:

* Infrastructure
* Data (in situ and in transit)
* Services and components
* Component boundaries and interfaces
* Business processes (or application logic)
* External dependencies

The output of threat modeling sessions is a set of identified threats, with associated risk ratings and mitigation strategies.

== Threat modeling methodologies

Potential threats SHOULD be identified using a structured methodology. The following standardized threat modeling frameworks are helpful. You may choose to use a combination of these frameworks, or a custom methodology tailored to your own needs.

=== STRIDE

Developed by Microsoft, this mnemonic-based framework categorizes threats into six groups:

|===
|Threat category |Definition |Example |Example of countermeasures

|*Spoofing*
|Impersonation of another user or system
|Faking an email address to manipulate the recipient into sharing confidential information
|Sender Policy Framework (SPF) and/or DomainKeys Identified Mail (DKIM) to verify the sender

|*Tampering*
|Unauthorized modification of data
|Modifying data on a website to redirect visitors to a phishing page
|Hashes and digital signatures for data validation and tamper detection

|*Repudiation*
|Measures attackers take to leave no trace of their malicious actions
|Altering log files to hide unauthorized access
|Audit and logging mechanisms to track all system activity, and automated log analysis to reveal suspicious events

|*Information disclosure*
|Leaking sensitive data to unauthorized parties
|Hacking into a database to steal credit card information
|Encryption of sensitive data, and access control mechanisms

|*Denial of service (DoS)*
|Rendering a system unusable
|Flooding a website with excessive requests to crash the server
|Rate limiting to prevent DoS, and load balancing to distribute traffic across multiple servers

|*Elevation of privilege*
|Gaining higher access levels than authorized
|Exploiting a vulnerability to elevate user permissions, allowing access to confidential data or systems
|Implementing the principle of least privilege with role-based access controls
|===

In threat modeling sessions, analysts systematically examine each system component against these six threat categories to identify potential vulnerabilities in the system design.

STRIDE works particularly well for software applications.

=== PASTA

PASTA – Process for Attack Simulation and Threat Analysis – is a multi-stage methodology that aligns business objectives with technical requirements. The stages progress through:

1. Defining the business objectives.
2. Defining the technical scope.
3. Decomposing the application into its component parts.
4. Identifying potential vulnerabilities.
5. Enumerating the likelihood and impact of attacks.

The end result is a comprehensive risk and impact assessment. PASTA can be a very time-consuming process so it does not lend itself to fast iterative development processes. It is most suited to long-lived critical systems.

=== VAST

VAST – Visual, Agile, and Simple Threat modeling – is designed to scale threat modeling across entire organizations and to work well with iterative development workflows. VAST's scalability makes it a good fit for organizations with multiple teams and products, and short release cycles.

VAST covers two types of threat modeling:

* Application threat modeling for development teams, focusing on process flow diagrams.
* Operational threat modeling for infrastructure teams, focusing on attack trees.

=== LINDDUN

LINDDUN is a privacy-focused threat modeling frameworks and it serves as a privacy-oriented counterpart to STRIDE. LINDDUN helps identify privacy threats by systematically examining how personal data flows through a system and where privacy violations may occur.

The name is an acronym for: Linkability, Identifiability, Non-repudiation, Detectability, Disclosure of information, Unwareness, Non-compliance.

LINDDUN is recommended for systems handling personal information, particularly those subject to regulations like GDPR or CCPA.

=== Attack trees

Attack trees are hierarchical diagrams representing how attackers might compromise a system to achieve a specific goal.

The tree's root represents the attacker's ultimate objective, with branches showing different paths or sub-goals needed to achieve it. Leaf nodes represent specific actions or vulnerabilities the attacker could exploit. Attack trees can be enriched with attributes like cost, likelihood, or required skill level.

Attack trees are useful models for visualizing complex attack scenarios that require multiple steps to compromise a system.

=== Kill chains

A kill chain (or cyber kill chain) is a framework originally developed by Lockheed Martin that models the stages of a cyber attack. The traditional seven stages are:

1. *Reconnaissance*: research and target identification.
2. *Weaponization*: creating a malicious payload.
3. *Delivery*: transmitting the weapon to the target.
4. *Exploit*: triggering the exploit.
5. *Installation*: installing malware.
6. *Command and control*: establishing remote access.
7. *Actions on objectives*: achieving the attacker's goal.

Understanding these stages helps defenders implement layered defenses. The framework is particularly valuable for understanding advanced threats.

== Risk ratings

Each identified threat SHOULD be rated based on its likelihood of occurrence and scale of impact. Combining the likelihood and impact scores gives an overall severity level, typically rated from high to low.

The following diagram shows a common risk rating scheme. You may design your own scoring system. The important thing is to be consistent in how you rank potential threats.

.Threat prioritization
image::./_/threat-prioritization.png[alt="",width=685,height=581]

== Mitigation strategies

The final stage of the threat modeling process is to decide on mitigation strategies for each identified threat. The rationale for the chosen countermeasures – or the reasons why no mitigation will be done – SHOULD be recorded against each threat.

Examples of countermeasures against common threats include:

* Two-factor authentication.
* Role-based access controls.
* Encryption of sensitive data at rest.
* Encrypted transport protocols.
* Message signatures.
* Logging, monitoring, and alerts.
* Rate limiting.
* Reducing data retention periods.
* Code review.
* Log rotation.
* Penetration testing.
* Dependency updates.
* Dependency version pinning.
* Scheduled security scans.

== Templates

The output of threat modeling sessions is a set of identified threats, with associated risk ratings and mitigation strategies.

The following serves as a useful starter template for reporting the outcomes of threat modeling sessions. See also link:./threat-modeling-session.example.adoc[this concrete example of a threat modeling assessment].

[source,markdown]
----
# Threat modeling session <YYYY-MM-DD>

- **System/application name**: _____
- **Session facilitator**: _____
- **Participants**:
  - **Business stakeholder**: _____
  - **Technical architect**: _____
  - **Development lead**: _____
  - **Security analyst**: _____
  - **Privacy officer** (eg. data controller): _____
  - **Other stakeholders**: _____

Pre-session checklist:

- [ ] Schedule participants.
- [ ] Gather architecture diagrams and documentation.
- [ ] Review previous threat models (if updating).
- [ ] Prepare collaboration tools (whiteboard, diagramming software).

Session checklist:

- [ ] Review business objectives and scope.
- [ ] Review component architecture, data flows, system interfaces, etc.
- [ ] Assess STRIDE threats against individual components.
- [ ] Rank risks based on assessment of likelihood and impact.
- [ ] Identify and prioritize mitigation strategies.

Post-session checklist:

- [ ] Distribute completed threat assessment to stakeholders.
- [ ] Create tickets for mitigation work.
- [ ] Schedule next treat modeling session.

## 1. Business context

What are the business objectives? Why does the system exist? What business value does it provide? What are the critical business functions?

Who are the key stakeholders?

What is the business impact of security/privacy failures – eg. financial, reputational, regulatory, operational, etc.?

## 2. Technical scope

Define what is being threat modeled. What the system boundaries, or the in-scope components?

What is the technology stack? What are the deployment environments? What are the integration points or interfaces with other (out-of-scope) systems?

## 3. Decomposition

How does the system work?

Include or link to architectural diagrams and other useful design documents and models.

Use the models to identify key components, data flows, entry points, trust boundaries, and the most sensitive assets.

### Key components

Identify the key components of the system, along with their trust levels and the categories of data they handle. Internal components tend to be trusted while external ones are not; components at the interface between internal and external components, such as API gateways, are semi-trusted.

|Component |Description |Trust level |Data handled |
|----------|------------|------------|-------------|
|...       |...         |...         |...          |
|...       |...         |...         |...          |
|...       |...         |...         |...          |

### Data flows

Identify the data flows between the key components. Include details of data types, transport protocols (and whether they are encrypted), and any authentication or signing systems in place.

|Source |Destination |Data type |Protocol |Authentication |
|-------|------------|---------|---------|----------------|
|...    |...         |...      |...      |...             |
|...    |...         |...      |...      |...             |
|...    |...         |...      |...      |...             |

### Sensitive assets

Identify the assets that must be protected from unauthorized access, eg. data, keys, certificates, and other secrets.

|Asset |Sensitivity |Integrity requirements |Availability requirements |Privacy concern |
|------|------------|-----------------------|--------------------------|----------------|
|...   |...         |...                    |...                       |...             |
|...   |...         |...                    |...                       |...             |
|...   |...         |...                    |...                       |...             |

### Entry points

Identify the external interfaces, APIs, and user interfaces to the system.

### Trust boundaries

Identify where trust changes, eg. internet to DMZ, DMZ to internal network.

## Threat assessment

Finally, consider the potential threats against the identified components, data flows, and assets. Use the STRIDE framework to rank each threat against each component/flow and rank the resulting risks.

|Ref |Component/Flow |Description |Type |Countermeasures |Likelihood |Impact |Rating |
|----|---------------|------------|-----|----------------|-----------|-------|-------|
|#1  |...            |..          |...  |...             |...        |...    |...    |
|#2  |...            |..          |...  |...             |...        |...    |...    |
|#3  |...            |..          |...  |...             |...        |...    |...    |
|#4  |...            |..          |...  |...             |...        |...    |...    |
|#5  |...            |..          |...  |...             |...        |...    |...    |

(Add links to issue trackers, resolution deadlines, etc. as required.)
----

For the threat assessment, an alternative structure is to analyze each component's vulnerability to each of the six STRIDE threat types, to ascertain if a sensitive asset can be compromised by the vulnerability.

[source,markdown]
----
## Component/Flow: _____

|Threat type |Threat description |Asset at risk | Countermeasures |Likelihood |Impact |Rating |
|------------|-------------------|--------------|-----------------|-----------|-------|-------|
|Spoofing    |...                |...           |...              |...        |...    |...    |
|Tampering   |...                |...           |...              |...        |...    |...    |
|Repudiation |...                |...           |...              |...        |...    |...    |
|Disclosure  |...                |...           |...              |...        |...    |...    |
|DoS         |...                |...           |...              |...        |...    |...    |
|Elevation   |...                |...           |...              |...        |...    |...    |

(Repeat for each critical component and data flow.)
----
